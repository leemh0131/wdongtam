<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name=”format-detection” content=”no” />
    <meta property="og:url" content="">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:image" content="">
    <meta property="og:description" content="">
    <meta name="title" content="">
    <meta name="Subject" content="">
    <meta name="keywords" content="">
    <meta name="Descript-xion" content="">
    <meta name="Description" content="">

    <link rel="icon" href="" type="image/x-icon" sizes="16x16">
    <link rel="stylesheet" href="css/styles.css">

    <title>우리동네탐정</title>
</head>

<body>
    <div class="wrap">

        <div class="header-page"></div>

        <section class="sub_wrap">
            <div class="container">

                <!--mo-->
                <div class="detail_top mo">
                    <div class="row">
                        <div class="col-12">
                            <div style="--swiper-navigation-color: #fff; --swiper-pagination-color: #fff"
                                class="swiper detail_img_02">
                                <div class="swiper-wrapper main-img">

                                </div>
                            </div>
                            <div thumbsSlider="" class="swiper detail_img_01">
                                <div class="swiper-wrapper main-img">

                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="detail_info">
                                <div class="detail_title">
                                    <h1></h1>
                                    <ul>
                                        <li>
                                            <i class="i i_person_add"></i>
                                        </li>
                                        <li>
                                            <i class="i i_share"></i>
                                        </li>
                                    </ul>
                                </div>
                                <dl class="partner-info">

                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!--pc-->
                <div class="detail_top pc">
                    <div class="row">
                        <div class="col-6">
                            <div style="--swiper-navigation-color: #fff; --swiper-pagination-color: #fff"
                                class="swiper detail_img_04">
                                <div class="swiper-wrapper main-img">

                                </div>
                            </div>
                        </div>
                        <div class="col-6 d-flex">
                            <div class="detail_info">
                                <div class="detail_title">
                                    <h1></h1>
                                    <ul>
                                        <li>
                                            <i class="i i_person_add"></i>
                                        </li>
                                        <li>
                                            <i class="i i_share"></i>
                                        </li>

                                    </ul>
                                </div>
                                <dl class="partner-info">

                                </dl>
                            </div>
                            <div thumbsSlider="" class="swiper detail_img_03">
                                <div class="swiper-wrapper main-img" >

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="detail_body">
                    <div class="row">
                        <div class="col-12 col-lg-8">
                            <div class="item_area" id="job-field">
                                <h4>전문분야</h4>
                                <div class="row">
                                </div>
                            </div>
                            <div class="item_area" id="job-ep" >
                                <h4>보유장비</h4>
                                <div class="row">
                                </div>
                            </div>
                            <div class="item_area" id="job-zone">
                                <h4>업무가능지역 - 지사보유</h4>
                                <div class="row">


                                </div>
                            </div>
                            <div class="item_area" id="partner-intro">
                                <h4>업체소개</h4>
                                <p></p>
                            </div>

                            <div class="item_area">
                                <h4>스페셜 광고</h4>
                                <div class="swiper_area mo">
                                    <div class="swiper special_ad">
                                        <div class="swiper-wrapper" id="special-blurb-mo">
                                            <!--모바일스페셜광고-->
                                        </div>
                                    </div>
                                </div>
                                <div class="special_wrap pc">
                                    <div class="row" id="special-blurb-pc">
                                        <!--PC스페셜광고-->
                                    </div>
                                </div>
                            </div>

                            <div class="item_area">
                                <h4>업체후기</h4>
                                <div class="review_wrap">
                                    <div class="review_top" id="review_tot">
                                        <!--<ul class="star">
                                            <li><img src="img/icon/i_star.svg" alt=""></li>
                                            <li><img src="img/icon/i_star_g.svg" alt=""></li>
                                            <li><img src="img/icon/i_star_g.svg" alt=""></li>
                                            <li><img src="img/icon/i_star_g.svg" alt=""></li>
                                            <li><img src="img/icon/i_star_g.svg" alt=""></li>
                                        </ul>
                                        <span>4.9 l <b>1000개의 평가</b></span>-->
                                        <p>실제 업체를 이용한 이용자들이 남긴 후기입니다.
                                            <button type="button" class="open_modal" data-modal-id="reviewWrite">후기 작성하기</button>
                                        </p>
                                    </div>
                                    <div class="review_body">
                                        <ul id="review_body_ul">

                                        </ul>
                                    </div>
                                    <ul class="pagination" id="pagination">
                                        <li class="prev">
                                            <img src="img/icon/i_chevron_left.svg" alt="">
                                        </li>
                                        <li class="next">
                                            <img src="img/icon/i_chevron_right.svg" alt="">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4 pc">
                            <div class="detail_side_wrap">
                                <div class="detail_box">
                                    <p class="red"><span>의뢰인 TIP</span></p>
                                    <h6>여러 업체들과 충분한 비교상담을 해보시고<br>업체 선정을 하시길 추천드립니다.</h6>
                                    <button onclick="contactUsShow()" type="button">무료상담 연결하기</button>
                                </div>
                                <div class="detail_box">
                                    <p class="blue"><span>동일 전문분야 업체</span></p>
                                    <ul id="blurb-side">
                                        <!--사이드광고-->
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </section>

        <div class="footer-page"></div>

        <!-- <div class="fixed_menu mo">
            <div class="fixed_wrap">
                <ul>
                    <li>
                        <a href="#">
                            <dl>
                                <dt>
                                    <img src="img/icon/i_map.png" alt="">
                                </dt>
                                <dd>지역별</dd>
                            </dl>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <dl>
                                <dt>
                                    <img src="img/icon/i_sliders.png" alt="">
                                </dt>
                                <dd>분야별</dd>
                            </dl>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <dl>
                                <dt>
                                    <img src="img/icon/i_chat.png" alt="">
                                </dt>
                                <dd>상담의뢰</dd>
                            </dl>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <dl>
                                <dt>
                                    <img src="img/icon/i_call_center.png" alt="">
                                </dt>
                                <dd>고객센터</dd>
                            </dl>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <dl>
                                <dt>
                                    <img src="img/icon/i_person.png" alt="">
                                </dt>
                                <dd>MY</dd>
                            </dl>
                        </a>
                    </li>
                </ul>
            </div>
        </div> -->
    </div>

    <div id="reviewWrite" class="modal_wrap">
        <div class="modal_content">
            <div class="modal_header">
                <h3 class="modal_title">후기작성</h3>
                <button class="close"></button>
            </div>
            <div class="modal_body">
                <div class="modal_review_box">
                    <h2>평점을 선택해주세요!</h2>
                    <div class="rating">
                        <input type="radio" id="star5" name="rating" value="5">
                        <label class="starSelect" for="star5"></label>
                        <input type="radio" id="star4" name="rating" value="4">
                        <label class="starSelect" for="star4"></label>
                        <input type="radio" id="star3" name="rating" value="3">
                        <label class="starSelect" for="star3"></label>
                        <input type="radio" id="star2" name="rating" value="2">
                        <label class="starSelect" for="star2"></label>
                        <input type="radio" id="star1" name="rating" value="1">
                        <label class="starSelect" for="star1"></label>
                    </div>
                </div>
                <div class="input_wrap">
                    <div class="input_group">
                        <input type="text" id="name" placeholder="이름">
                    </div>
                    <div class="input_group">
                        <textarea name="" id="rmk_dc" cols="30" rows="10" placeholder="내용을 입력해주세요"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal_footer">
                <div class="btn_group">
                    <button type="button" onclick="reviewWrite()" class="btn_check">확인</button>
                    <button type="button" class="btn_close close">취소</button>
                </div>
            </div>
        </div>
    </div>

    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.bundle.min.js"></script>
    <script src="lib/swiper-bundle.min.js"></script>
    <script src="js/examples.js"></script>
    <script src="js/partnerCommon.js"></script>
    <script>

        let itemsPerPage = 4; // 페이지당 보여줄 항목 수
        let currentPageGroup = 1; // 현재 페이지 그룹
        let itemsInGroup = 5; // 페이지 그룹 당 보여질 페이지 수
        let totalItems = 0; // 총 갯수

        var detail_img_01 = new Swiper(".detail_img_01", {
            spaceBetween: 10,
            slidesPerView: 4,
            freeMode: true,
            watchSlidesProgress: true,
        });
        var detail_img_02 = new Swiper(".detail_img_02", {
            spaceBetween: 10,
            // navigation: {
            //   nextEl: ".swiper-button-next",
            //   prevEl: ".swiper-button-prev",
            // },
            autoplay: {
                delay: 2000,
            },
            thumbs: {
                swiper: detail_img_01,
            },
        });

        var detail_img_03 = new Swiper(".detail_img_03", {
            spaceBetween: 10,
            slidesPerView: 4,
            freeMode: true,
            watchSlidesProgress: true,
        });
        var detail_img_04 = new Swiper(".detail_img_04", {
            spaceBetween: 10,
            // navigation: {
            //   nextEl: ".swiper-button-next",
            //   prevEl: ".swiper-button-prev",
            // },
            autoplay: {
                delay: 2000,
            },
            thumbs: {
                swiper: detail_img_03,
            },
        });

        const url = new URL(window.location.href);
        // URLSearchParams 객체
        const urlParams = url.searchParams;
        let partnerCd = nvl(urlParams.get('partnerCd'));

        $(document).ready(function(){
            $(".header-page").load("/header.html");
            $(".footer-page").load("/footer.html");

            let result = getPartnerDetail('prod', partnerCd);
            //let result = getPartnerDetail('local', partnerCd);

            console.log(result);

            let partnerInfo = result.partner;

            // 광고상세
            $('.detail_title h1').text(nvl(partnerInfo.PARTNER_NM, '정보없음'));

            let partnerInfoHtml =   `<dt>무료상담</dt>` +
                `<dd id="tel-no">` + nvl(partnerInfo.TEL_NO, '정보없음') + `</dd>` +
                `<dt>홈페이지</dt>` +
                `<dd class="td_unline"><a target='_blank' href="` + nvl(partnerInfo.HOME_PAGE, '#') + `">` + nvl(partnerInfo.HOME_PAGE, '정보없음') + `</a></dd>` +
                `<dt>카카오톡</dt>` +
                `<dd>` + nvl(partnerInfo.KAKAOTALK, '정보없음') + `</dd>` +
                `<dt>텔레그램</dt>` +
                `<dd>` + nvl(partnerInfo.TELEGRAM, '정보없음') + `</dd>` +
                `<dt>유튜브</dt>` +
                `<dd>` + nvl(partnerInfo.YOUTUBE_LINK) + `</dd>` ;
            //`<dt>업무가능지역</dt>`;

            let jobZone = nvl(result.job_zone);
            let jobZoneSubHtml = '';
            if(jobZone != ''){
                let jobZoneHtml =   `<dd>` +
                    `<ul class="area">`;
                for(let i = 0; i < jobZone.length; i++){
                    jobZoneHtml += `<li><i class="i i_pin"></i>` + jobZone[i] + `</li>`

                    jobZoneSubHtml +=`
                                    <div class="col-4 col-lg-3 item">` +
                        `<img src="img/icon/i_pin.svg" alt="">` + jobZone[i] +
                        `</div>`;
                }
                jobZoneHtml += `</ul></dd>`;

//                partnerInfoHtml += jobZoneHtml;

            }
            $('.partner-info').append(partnerInfoHtml);

            //이미지
            let img = nvl(result.img);
            let imgHtml = '';
            if(nvl(img) != ''){
                for (let i = 0; i < img.length; i++){
                    imgHtml +=
                        `<div class="swiper-slide">`+
                        `<img onError="this.src='img/sample/sample_01.png'" src="` + img[i].img_url + `" />`+
                        `</div>`;
                }
                $('.main-img').append(imgHtml);
            } else {
                imgHtml +=
                    `<div class="swiper-slide">`+
                    `<img src="img/sample/sample_11.png" />` +
                    `</div>`;
                $('.main-img').append(imgHtml);
            }

            /*<div class="swiper-slide">
            <img src="img/sample/sample_11.png" />
            </div>*/


            //업체소개
            $('#partner-intro p').html(nvl(partnerInfo.COMPANY_INTRO_HTML));

            //업무가능지역 - 자사보유
            $('#job-zone div.row').append(jobZoneSubHtml);

            //전문분야
            let jobField = nvl(result.job_field);
            let jobFieldIcon = nvl(result.job_field_icon);
            if(jobField != ''){
                for(let i = 0; i < jobField.length; i++){

                    let html =  `<div class="col-4 col-lg-3 item">` +
                        `<img src="` + nvl(jobFieldIcon[i]) + `" alt="" >` + jobField[i] +
                        `</div>`;
                    $('#job-field div.row').append(html);
                }
            }

            //전문분야
            let jobEp = nvl(result.job_ep);
            let jobEpIcon = nvl(result.job_ep_icon);
            if(jobEp != ''){
                for(let i = 0; i < jobEp.length; i++){

                    let html =  `<div class="col-4 col-lg-3 item">` +
                        `<img src="` + nvl(jobEpIcon[i]) + `" alt="" >` + jobEp[i] +
                        `</div>`;
                    $('#job-ep div.row').append(html);
                }
            }


            //스페셜광고
            let blurbSpecial = nvl(result.blurbSpecial);
            if(blurbSpecial != ''){

                for(let i = 0; i < blurbSpecial.length; i++){
                    let pcSpecialHtml =
                        `<div class="col-3">` +
                        `<div class="special_box">` +
                        `<img onError="this.src='img/sample/sample_01.png'" src="` + blurbSpecial[i].img_url + `" alt="">` +
                        `<div class="special_box_info">` +
                        `<h1>` + blurbSpecial[i].partner_nm + `</h1>` +
                        `<p>무료상담 : `+ blurbSpecial[i].tel_no +`</p>` +
                        `<button onClick="blurbDetailPage(this)" id="` + blurbSpecial[i].partner_cd + `" type="button">상세보기</button>` +
                        `</div>` +
                        `</div>` +
                        `</div>`;

                    $("#special-blurb-pc").append(pcSpecialHtml);

                    let moSpecialHtml =
                        `<div class="swiper-slide">` +
                        `<div class="special_box">` +
                        `<img onError="this.src='img/sample/sample_01.png'" src="` + blurbSpecial[i].img_url + `" alt="">` +
                        `<div class="special_box_info">` +
                        `<h1>` + blurbSpecial[i].partner_nm + `</h1>` +
                        `<p>무료상담 : `+ blurbSpecial[i].tel_no +`</p>` +
                        `<button onClick="blurbDetailPage(this)" id="` + blurbSpecial[i].partner_cd + `" type="button">상세보기</button>` +
                        `</div>` +
                        `</div>` +
                        `</div>`;

                    $("#special-blurb-mo").append(moSpecialHtml);

                }

            }

            //사이드광고
            let blurbSide = nvl(result.blurbSide);
            if(blurbSide != ''){

                for(let i = 0; i < blurbSide.length; i++){

                    let blurbSideHtml =
                        `<li>` +
                        `<div class="detail_side_box">` +
                        `<img onError="this.src='img/sample/sample_01.png'" src="` + blurbSide[i].img_url + `" alt="">` +
                        `<h4>` + blurbSide[i].partner_nm + `</h4>` +
                        `<p>편하게 연락주시면 친절한 상담 도와드리겠습니다.</p>` +
                        `<button onClick="blurbDetailPage(this)" id="` + blurbSide[i].partner_cd + `" type="button">상세보기</button>` +
                        `</div>` +
                        `</li>`;

                    $("#blurb-side").append(blurbSideHtml);
                }

            }

            //리뷰
            let reviewCount = nvl(partnerInfo.COUNT, 0);
            let reviewAverage = nvl(partnerInfo.STAR_SCORE_TOT, 0);
            totalItems = reviewCount;
            let reviewSpan = `<span>` + reviewAverage + ` l <b>` + reviewCount + `개의 평가</b></span>`

            let starImg = `<ul class="star">`;
            for(let i = 1; i < 6; i++){
                if(reviewAverage >= i){
                    starImg += `<li><img src="img/icon/i_star.svg" alt=""></li>`
                }else {
                    starImg += `<li><img src="img/icon/i_star_g.svg" alt=""></li>`
                }
            }
            starImg += `</ul>`

            $('#review_tot').append(starImg);
            $('#review_tot').append(reviewSpan);

            //페이징
            generatePaging(totalItems, itemsPerPage, currentPageGroup, itemsInGroup, reviewCallback);
            const page1Element = $("#pagination li:contains('1')"); // 페이지 번호가 1인 요소를 선택
            page1Element.click(); // 가상으로 클릭


            detail_img_03.update();
            detail_img_01.update();
        });

        function connect(){

            /*let telNo = nvl($('#tel-no').text()).replaceAll('-', '');

            // 만약 전화번호가 유효하다면 tel 링크 생성
            if (nvl(telNo) != '' && nvl(telNo) != '정보없음') {
                let telLink = document.createElement('a');
                telLink.href = 'tel:' + telNo;
                telLink.textContent = '전화 걸기'; // 원하는 링크 텍스트를 설정할 수 있습니다

                // 클릭 이벤트 발생
                telLink.click();

            } else {
                // 전화번호가 유효하지 않을 때 처리할 내용
                alert('유효한 전화번호가 없습니다.');
            }*/

        }

        function reviewWrite(){

            let name = nvl($('#name').val());
            let rmk_dc = nvl($('#rmk_dc').val());

            let radioButtons = $('input[name="rating"]');

            let checkedCount = 0;

            for (var i = 0; i < radioButtons.length; i++) {
                if (radioButtons[i].checked) {
                    checkedCount = 5 - i;
                }
            }

            if(name == ''){
                alert("이름을 입력하세요");
                return;
            }

            if(rmk_dc == ''){
                alert("내용을 입력하세요");
                return;
            }

            if(checkedCount == 0){
                alert("평점을 선택하세요");
                return;
            }

            let param = {
                PARTNER_CD : partnerCd,
                COMPANY_CD : '1000',
                NAME : name,
                RMK_DC : rmk_dc,
                STAR_SCORE : checkedCount,
            }

            let result = setReviewWrite('prod', param);
            //let result = setReviewWrite('local', param);

            try {

                if(nvl(result.map) != ''){
                    result = result.map;

                    if(nvl(result.response) == 'ok'){
                        alert("작성이 완료되었습니다.");
                        location.reload();
                    } else {
                        throw "Error";
                    }

                }

            } catch (e){
                alert("네트워크 오류발행");
                return;
            }

        }

        let reviewCallback = function (page){

            let param = {
                COMPANY_CD : "1000",
                PARTNER_CD : partnerCd,
                LIMIT : itemsPerPage,
                OFFSET : parseInt(page) -1,
            }

            $('#review_body_ul').empty() // 자식요소 제거
            //let list = nvl(getReviewList('prod', param).map);
            let list = nvl(getReviewList('prod', param).map);
            if(list != ''){
                list = list.list;
                let reviewHtml = ``;
                for(let i = 0; i < list.length; i++){
                    reviewHtml += `<li>`;
                        reviewHtml += `<div class="review_box">`;
                            reviewHtml += `<img src="img/icon/i_user.svg" alt="">`;
                            reviewHtml += `<div class="review_info">`;
                                reviewHtml += `<div class="user_name">` + list[i].NAME + `</div>`;
                                reviewHtml += `<div class="review_top">`;
                                    reviewHtml += `<ul class="star">`;
                                        for(let j = 1; j < 6; j++){
                                            if(nvl(list[i].STAR_SCORE, 0) >= j){
                                                reviewHtml += `<li><img src="img/icon/i_star.svg" alt=""></li>`
                                            }else {
                                                reviewHtml += `<li><img src="img/icon/i_star_g.svg" alt=""></li>`
                                            }
                                        }
                                    reviewHtml += '</ul>';
                                    reviewHtml += '<span>' + list[i].STAR_SCORE + ' l <b>' + list[i].DTS + '</b></span>';
                                reviewHtml += '</div>';
                            reviewHtml += '</div>';
                            reviewHtml += '<div class="review_text">';
                                reviewHtml += '<p>' + list[i].RMK_DC + '</p>';
                            reviewHtml += '</div>';
                        reviewHtml += '</div>';
                    reviewHtml += '</li>';
                }
                $('#review_body_ul').append(reviewHtml);
            }


        }

        // 모달 열기 버튼 클릭 이벤트
        $(".open_modal").click(function () {
            var modalId = $(this).data("modal-id");
            $("#" + modalId).css("display", "flex");
        });

        // 모달 닫기 버튼 및 모달 바깥 영역 클릭 이벤트
        $(".close, .modal_wrap").click(function () {
            $(".modal_wrap").css("display", "none");
        });

        // 모달 내부 클릭 시 닫기 방지
        $(".modal_content").click(function (e) {
            e.stopPropagation();
        });


    </script>

</body>

</html>
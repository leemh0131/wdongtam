<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name=”format-detection” content=”no” />
    <meta property="og:url" content="">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:image" content="">
    <meta property="og:description" content="">
    <meta name="title" content="">
    <meta name="Subject" content="">
    <meta name="keywords" content="">
    <meta name="Descript-xion" content="">
    <meta name="Description" content="">

    <link rel="icon" href="" type="image/x-icon" sizes="16x16">
    <link rel="stylesheet" href="css/styles.css">

    <title>우리동네탐정</title>
</head>

<body>
    <div class="wrap">

        <div class="header-page"></div>

        <div class="sub_wrap">
            <!-- 탐정 찾기 -->
            <section class="search_wrap">
                <div class="container">
                    <div class="sub_search_box">
                        <div class="row">
                            <div class="col-12 col-lg-3">
                                <div class="input_group">
                                    <label for="">통합검색</label>
                                    <input id="keyword-search" type="text" placeholder="검색어를 입력하세요">
                                </div>
                            </div>
                            <div class="col-12 col-lg-3">
                                <div class="input_group type2">
                                    <label for="">지역선택</label>
                                    <i class="i i_geo"></i>
                                    <input type="text" placeholder="전체" id="region">
                                </div>
                            </div>
                            <div class="col-12 col-lg-3">
                                <div class="input_group type2">
                                    <label for="">분류선택</label>
                                    <i class="i i_sliders"></i>
                                    <input type="text" placeholder="" id="selectCategory">
                                </div>
                            </div>
                            <div class="col-12 col-lg-2">
                                <button onclick="search()" type="button">검색</button>
                            </div>
                        </div>
                    </div>

                    <div class="region_wrap">
                        <ul>
                            <li class="active" id="all">
                                <dl>
                                    <dt>
                                        <i class="i i_all"></i>
                                    </dt>
                                    <dd>전체</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_seoul"></i>
                                    </dt>
                                    <dd>서울</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_gyeonggido"></i>
                                    </dt>
                                    <dd>경기</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_incheon"></i>
                                    </dt>
                                    <dd>인천</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_daejeon"></i>
                                    </dt>
                                    <dd>대전</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_daegu"></i>
                                    </dt>
                                    <dd>대구</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_busan"></i>
                                    </dt>
                                    <dd>부산</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_gw"></i>
                                    </dt>
                                    <dd>광주</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_uisan"></i>
                                    </dt>
                                    <dd>울산</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_sejong"></i>
                                    </dt>
                                    <dd>세종</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_gangwon"></i>
                                    </dt>
                                    <dd>강원</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_chungbuk"></i>
                                    </dt>
                                    <dd>충북</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_chungnam"></i>
                                    </dt>
                                    <dd>충남</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_jeonbuk"></i>
                                    </dt>
                                    <dd>전북</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_jeonnam"></i>
                                    </dt>
                                    <dd>전남</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_gyeongbuk"></i>
                                    </dt>
                                    <dd>경북</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_gyeongnam"></i>
                                    </dt>
                                    <dd>경남</dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>
                                        <i class="i i_jeju"></i>
                                    </dt>
                                    <dd>제주</dd>
                                </dl>
                            </li>
                        </ul>
                    </div>

                    <div class="select_category_wrap">
                        <h2>상세분류</h2>
                        <ul class="category" id="category">

                        </ul>
                    </div>
                </div>
            </section>

            <section class="content">
                <div class="container">
                    <div class="row">
                        <div class="col-12 col-lg-8">
                            <div class="content_box">
                                <ul id="content-item">

                                </ul>
                            </div>
                        </div>

                        <div class="col-lg-4 pc">
                            <div class="detail_side_wrap">
                                <div class="detail_box">
                                    <p class="red"><span>의뢰인 TIP</span></p>
                                    <h6>여러 업체들과 충분한 비교상담을 해보시고<br>업체 선정을 하시길 추천드립니다.</h6>
                                    <button onclick="contactUsShow()" type="button">무료상담 연결하기</button>
                                </div>
                                <div class="detail_box">
                                    <p class="blue"><span>동일 전문분야 업체</span></p>
                                    <ul class="blurb-side">

                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </section>

            <section class="ad_wrap">
                <div class="item_area">
                    <h4>스페셜 광고</h4>
                    <div class="swiper_area mo">
                        <div class="swiper special_ad">
                            <div class="swiper-wrapper" id="blurb-special-mo">

                            </div>
                        </div>
                    </div>

                    <div class="special_wrap pc">
                        <div class="swiper pc_special_ad">
                            <div class="swiper-wrapper" id="blurb-special-pc">

                            </div>
                            <div class="swiper-pagination"></div>
                        </div>
                    </div>
                </div>
            </section>


        </div>


        <div class="footer-page"></div>


    </div>

    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.bundle.min.js"></script>
    <script src="lib/swiper-bundle.min.js"></script>
    <script src="js/swiper.js"></script>
    <script src="js/examples.js"></script>
    <script src="js/partnerCommon.js"></script>

    <script>
        $(document).ready(function(){
            $(".header-page").load("/header.html");
            $(".footer-page").load("/footer.html");

            const url = new URL(window.location.href);
            // URLSearchParams 객체
            const urlParams = url.searchParams;
            let keyword = nvl(urlParams.get('keyword'));
            let region = nvl(urlParams.get('region'));
            let partnerTp = nvl(urlParams.get('partnerTp'));

            if(keyword != ''){
                $('#keyword-search').val(keyword);
            }

            // 지역선택
            $("#region").click(function () {
                $(".region_wrap").toggle();

                let item = nvl($("#region").attr("item"));

                //전체 클릭
                let regionList = $(".region_wrap ul li dd");
                if(item == ''){
                    $(".region_wrap ul li dd")[0].click();
                } else {
                    item = item.split("|");
                    //$(".region_wrap ul li").removeClass();
                    for(let i = 0; i < regionList.length; i++){
                        for(let j = 0;j < item.length; j++){
                            if(regionList[i].innerText == item && $($(".region_wrap ul li")[2]).attr('class') != 'active'){
                                $(".region_wrap ul li dd")[i].click();
                            }
                        }
                    }
                }

            });

            $(".region_wrap ul li").click(function () {

                let item = $(this).find('dd').text();
                $(this).toggleClass("active");
                if(item == '전체'){
                    $(".region_wrap ul li").removeClass();
                    $(this).toggleClass("active");
                    $("#region").attr("placeholder", "전체");
                    $("#region").attr("item", "");
                } else {
                    $("#all").removeClass();
                    if(nvl($("#region").attr("placeholder")) == '전체'){
                        $("#region").attr("placeholder", '');
                        $("#region").attr("item", "");
                    }

                    if($(this).attr('class') == 'active'){
                        let regionItem = nvl($("#region").attr("item")) + item + "|";
                        $("#region").attr("item", regionItem);
                    } else {
                        let regionItem = nvl($("#region").attr("item")).replaceAll(item+"|", "");
                        $("#region").attr("item", regionItem);
                    }

                    let itemText = nvl($("#region").attr("item"));

                    if(itemText != ''){
                        itemText = itemText.replace(/\|$/, '');
                        itemText = itemText.replaceAll("|", ", ");
                        $("#region").attr("placeholder", itemText);
                    } else {
                        $("#all").toggleClass("active");
                        $("#region").attr("placeholder", "전체");
                        $("#region").attr("item", "");
                    }

                }
                console.log($("#region").attr("item"));
            })



            if(region != ''){
                $("#region").attr("item", region);
                $("#region").click();
            }

            let category = getCategory('prod').map;

            //<li>카테고리</li>
            //<li class='active'>카테고리</li>
            for(let i = 0; i < category.list.length; i++){
                $('#category').append('<li>' + category.list[i].CATEGORY_NM + '</li>');
            }

            // 분류선택
            $("#selectCategory").click(function () {
                $(".select_category_wrap").toggle();
            });

            $(".category li").click(function () {
                $(this).toggleClass("active");

                let item = $(this).text();

                if($(this).attr('class') == 'active'){
                    let selectCategoryItem = nvl($("#selectCategory").attr("item")) + item + "|";
                    $("#selectCategory").attr("item", selectCategoryItem);
                } else {
                    let selectCategoryItem = nvl($("#selectCategory").attr("item")).replaceAll(item+"|", "");
                    $("#selectCategory").attr("item", selectCategoryItem);
                }

                let itemText = nvl($("#selectCategory").attr("item"));

                if(itemText != ''){
                    itemText = itemText.replace(/\|$/, '');
                    itemText = itemText.replaceAll("|", ", ");
                    $("#selectCategory").attr("placeholder", itemText);
                } else {
                    $("#selectCategory").attr("placeholder", '');
                }

            });

            search();

            searchBlurb(partnerTp);

        });

        //찾기페이지 스페셜 및 세로광고
        function searchBlurb(partnerTp){

            let result = getSearchPageBlurb(partnerTp, 'prod');

            $(".blurb-side").empty();
            $("#blurb-special-pc").empty();
            $("#blurb-special-mo").empty();

            if(result != ''){
                result = nvl(result.map);
                if(result != ''){

                    let blurbSide = result.blurbSide;

                    for(let i = 0; i < blurbSide.length; i++){
                        let blurbSideHtml =
                                            `<li>` +
                                            `<div class="detail_side_box">` +
                                            `<img onError="this.src='img/sample/sample_01.png'" src="` + blurbSide[i].img_url + `" alt="">` +
                                            `<h4>` + blurbSide[i].partner_nm + `</h4>` +
                                            `<p>편하게 연락주시면 친절한 상담 도와드리겠습니다.</p>` +
                                            `<button onClick="blurbDetailPage(this)" id="` + blurbSide[i].partner_cd + `" type="button">상세보기</button>` +
                                            `</div>` +
                                            `</li>`;
                        $(".blurb-side").append(blurbSideHtml);
                    }


                    let blurbSpecial = result.blurbSpecial;

                    for(let i = 0; i < blurbSpecial.length; i++){
                        let pcSpecialHtml =
                            `<div class="swiper-slide">` +
                            `<div class="special_box">` +
                            `<img onError="this.src='img/sample/sample_01.png'" src="` + blurbSpecial[i].img_url + `" alt="">` +
                            `<div class="special_box_info">` +
                            `<h1>` + blurbSpecial[i].partner_nm + `</h1>` +
                            `<p>무료상담 : `+ blurbSpecial[i].tel_no +`</p>` +
                            `<button onClick="blurbDetailPage(this)" id="` + blurbSpecial[i].partner_cd + `" type="button">상세보기</button>` +
                            `</div>` +
                            `</div>` +
                            `</div>`;

                        $("#blurb-special-pc").append(pcSpecialHtml);

                        $("#blurb-special-mo").append(pcSpecialHtml);
                    }

                }

            }

        }

        //검색버튼 클릭
        function search(){

            $('#content-item').empty() // 자식요소 제거

            const url = new URL(window.location.href);
            // URLSearchParams 객체
            const urlParams = url.searchParams;
            let keyword = $('#keyword-search').val();
            let region = $("#region").attr("item");
            let selectCategory = $("#selectCategory").attr("item");
            let partnerTp = nvl(urlParams.get('partnerTp'));

            let param = {
                COMPANY_CD : "1000",
                KEYWORD : nvl(keyword),
                REGION : nvl(region),
                SELECTCATEGORY : nvl(selectCategory),
                PARTNER_TP : nvl(partnerTp),
            }

            let list = getPartnerSearch('prod', param);

            if(nvl(list.map.list) != ''){

                list = list.map.list;
                for(let i = 0; i < list.length; i++){
                    let color = list[i].PARTNER_TP == "탐정" ? 'orange' : 'blue';
                    $('#content-item').append(
                        `<li>`
                            + `<div class="list_item">`
                                + `<img onclick="blurbDetailPage(this)"  id="` + list[i].PARTNER_CD + `"  onError="this.src='img/sample/sample_01.png'" src="` + list[i].IMG_URL + `" alt="">`
                                    + `<div class="list_info">`
                                        + `<span class="` + color + `">` + list[i].PARTNER_TP + `</span>`
                                        + `<h6>` + list[i].PARTNER_NM + `</h6>`
                                        + `<p>` + list[i].JOB_ZONE + `</p>`
                                        + `<p><span>` + list[i].COMPANY_INTRO + `</span></p>`
                                        + `</p>`
                                    + `</div>`
                            + `</div>`
                        + `</li>`
                    );
                }

            } else {
                alert("조회된 리스트가 없습니다.");
            }


        }

    </script>

</body>

</html>
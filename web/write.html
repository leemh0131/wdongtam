<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name=”format-detection” content=”no” />
    <meta property="og:url" content="">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:image" content="">
    <meta property="og:description" content="">
    <meta name="title" content="">
    <meta name="Subject" content="">
    <meta name="keywords" content="">
    <meta name="Descript-xion" content="">
    <meta name="Description" content="">

    <link rel="icon" href="" type="image/x-icon" sizes="16x16">
    <link rel="stylesheet" href="/css/styles.css">

    <title>우리동네탐정</title>
</head>

<body>
    <div class="wrap">

        <div class="header-page"></div>

        <!-- s:모바일 메뉴 -->
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-header">
                <h5>전체메뉴</h5>
                <ul>
                    <li>
                        <a href="#">로그인</a>
                    </li>
                    <li>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </li>
                </ul>
            </div>
            <div class="offcanvas-body">
                <div class="offcanvas_banner">
                    <img src="/img/sample/sample_06.png" alt="">
                </div>
                <div class="menu">
                    <h2>업체가 고민이라면 지금</h2>
                    <ul>
                        <li>
                            <a href="#">
                                <dl>
                                    <dt>
                                        <img src="/img/icon/i_detective.png" alt="">
                                    </dt>
                                    <dd>탐정찾기</dd>
                                </dl>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <dl>
                                    <dt>
                                        <img src="/img/icon/i_secretary.png" alt="">
                                    </dt>
                                    <dd>행정사찾기</dd>
                                </dl>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <dl>
                                    <dt>
                                        <img src="/img/icon/i_chat_2.png" alt="">
                                    </dt>
                                    <dd>상담의뢰</dd>
                                </dl>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="notice">
                    <ul>
                        <li>공지사항</li>
                        <li>의뢰상담글을 작성하진 모든분께 스타벅스 아메리카노</li>
                        <li>
                            <button type="button">
                                <img src="/img/icon/i_chevron_right_w.png" alt="">
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <section class="sub_wrap">
            <!-- s: 상단광고 -->
            <div class="swiper_wrap mo">
                <div class="swiper mainSwiper02">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <a href="javascript:void(0);">
                                <img src="/img/sample/sample_02.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-slide">
                            <a href="javascript:void(0);">
                                <img src="/img/sample/sample_03.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-slide">
                            <a href="javascript:void(0);">
                                <img src="/img/sample/sample_04.png" alt="">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper_wrap pc">
                <div class="container">
                    <div class="row mb-3">
                        <div class="col-7">
                            <img src="/img/sample/sample_08.png" alt="">
                        </div>
                        <div class="col-5">
                            <div class="row">
                                <div class="col-6">
                                    <img src="/img/sample/sample_09.png" alt="">
                                </div>
                                <div class="col-6">
                                    <img src="/img/sample/sample_10.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- e: 상단광고 -->

            <section class="write_wrap">
                <div class="container">
                    <div class="con_top">
                        <h3>작성하기</h3>
                    </div>
                    <div class="con_body">
                        <div class="input_wrap">
                            <div class="custom_select">
                                <span class="selected_option">주제</span>
                                <ul class="options">
                                    <!--<li data-value="option1">옵션 1</li>
                                    <li data-value="option2">옵션 2</li>
                                    <li data-value="option3">옵션 3</li>-->
                                </ul>
                            </div>
                            <div class="input_group">
                                <input id="title" type="text" placeholder="제목">
                            </div>
                            <div class="input_group">
                                <textarea name="" id="contents" cols="30" rows="10" placeholder="내용을 입력해주세요"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="con_fot">
                        <div class="btn_group">
                            <button onclick="writing();" type="button" class="btn_check">확인</button>
                            <button onclick="window.history.back()" type="button" class="btn_close back_button">뒤로</button>
                        </div>
                    </div>
                </div>
            </section>

        </section>

        <div class="footer-page"></div>

    </div>


    <script src="/lib/jquery.min.js"></script>
    <script src="/lib/bootstrap.bundle.min.js"></script>
    <script src="/lib/swiper-bundle.min.js"></script>
    <script src="/js/swiper.js"></script>
    <script src="/js/examples.js"></script>
    <script src="js/partnerCommon.js"></script>
    <script>
        const url = new URL(window.location.href);
        // URLSearchParams 객체
        const urlParams = url.searchParams;
        let communityTp = nvl(urlParams.get('communityTp'));

        if(communityTp == ''){
            alert("잘못된경로로 들어왔습니다.");
            window.history.back();
        }

        $(document).ready(function(){

            $(".header-page").load("/header.html");
            $(".footer-page").load("/footer.html");

            let param = {
                COMPANY_CD : "1000",
                FIELD_CD : "ES_Q0137",
            }

            let codes = getCommonCode('prod', param).map;
            //let codes = getCommonCode('local', param).map;

            if(codes != ''){
                codes = codes.list;
                $('.options').empty();
                for(let i = 0; i < codes.length; i++){
                    $('.options').append(`<li data-value="` + codes[i].CODE + `">` + codes[i].NAME + `</li>`);
                }
            }

        });

        $(document).on("click", ".options li", function(e) {
            // 클릭 이벤트 처리
            let code = $(this).data("value");
            let text = e.target.textContent;
            $('.selected_option').text(text);
            $('.selected_option').attr('id', code);
        });

        function writing(){

            let COMMUNITY_ST = nvl($('.selected_option').attr('id'));
            let TITLE = nvl($('#title').val());
            let CONTENTS = nvl($('#contents').val());

            if(TITLE == ''){
                alert("제목을 입력해주세요");
            }

            if(CONTENTS == ''){
                alert("내용을 입력해주세요");
            }

            if(COMMUNITY_ST == ''){
                alert("주제를 선택해주세요.");
            }

            let param = {
                COMPANY_CD : '1000',
                COMMUNITY_TP : communityTp,
                COMMUNITY_ST : COMMUNITY_ST,
                TITLE : TITLE,
                CONTENTS : CONTENTS
            }

            //let result = setWrite('local', param);
            let result = setWrite('prod', param);

            try {

                if(nvl(result.map) != ''){
                    result = result.map;

                    if(nvl(result.response) == 'ok'){
                        alert("작성이 완료되었습니다.");
                        if(communityTp == '01'){
                            location.href = '/consulting.html';
                        } else {
                            //커뮤니티 페이지 필요;
                        }
                    } else {
                        throw "Error";
                    }

                }

            } catch (e){
                alert("네트워크 오류발행");
                return;
            }

        }


    </script>


</body>

</html>